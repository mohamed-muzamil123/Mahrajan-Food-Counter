  // Export & Print
      document
        .getElementById("export-btn")
        .addEventListener("click", async () => {
          let servedOrders = [];
          try {
            const snapshot = await db
              .collection("orders")
              .where("status", "==", "served")
              .get();
            snapshot.forEach((doc) => {
              const data = doc.data();
              if (data.status !== "cancelled") {
                servedOrders.push({ id: doc.id, ...data });
              }
            });
          } catch (error) {
            console.error("Error fetching orders:", error);
            alert("Error fetching orders: " + error.message);
            return;
          }
          // Aggregate per student
          const studentTotals = {};
          servedOrders.forEach((order) => {
            const roll = order.rollNo;
            if (!studentTotals[roll]) {
              const student = window.students.find((s) => s.uniqueNo === roll);
              studentTotals[roll] = {
                name: student ? student.name : "Unknown",
                uniqueNo: roll,
                items: {},
              };
            }
            Object.entries(order.items || {}).forEach(([food, qty]) => {
              if (qty > 0) {
                studentTotals[roll].items[food] =
                  (studentTotals[roll].items[food] || 0) + parseInt(qty);
              }
            });
          });
          // Kitchen summary
          const kitchenSummary = {};
          servedOrders.forEach((order) => {
            Object.entries(order.items || {}).forEach(([food, qty]) => {
              if (qty > 0) {
                kitchenSummary[food] =
                  (kitchenSummary[food] || 0) + parseInt(qty);
              }
            });
          });
          // Build student rows
          let studentRows = "";
          Object.values(studentTotals).forEach((s) => {
            if (Object.keys(s.items).length > 0) {
              const itemsStr = Object.entries(s.items)
                .map(([food, qty]) => food + " x " + qty)
                .join(", ");
              studentRows +=
                "<tr><td>" +
                s.name +
                "</td><td>" +
                s.uniqueNo +
                "</td><td>" +
                itemsStr +
                "</td></tr>";
            }
          });
          // Build kitchen rows
          let kitchenRows = "";
          Object.entries(kitchenSummary).forEach(([food, qty]) => {
            if (qty > 0) {
              kitchenRows +=
                "<tr><td>" + food + "</td><td>" + qty + "</td></tr>";
            }
          });
          const printHTML = `
            <!DOCTYPE html>
            <html>
            <head>
              <title>Served Orders</title>
              <style>
                body { font-family: Arial, sans-serif; margin: 20px; }
                table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
                th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                th { background-color: #f2f2f2; }
                h1, h2 { color: #333; }
              </style>
            </head>
            <body>
              <h1>Served Orders</h1>
              <table>
                <thead><tr><th>Name</th><th>Roll No</th><th>Items</th></tr></thead>
                <tbody>${studentRows}</tbody>
              </table>
              <h2>Kitchen Summary</h2>
              <table>
                <thead><tr><th>Food Item</th><th>Quantity</th></tr></thead>
                <tbody>${kitchenRows}</tbody>
              </table>
            </body>
            </html>
          `;
          const printWindow = window.open(
            "",
            "_blank",
            "width=800,height=600,scrollbars=yes"
          );
          printWindow.document.write(printHTML);
          printWindow.document.close();
        });